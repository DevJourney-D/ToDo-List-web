<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Debugger - ToDo List App</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .result-success { background: #d1fae5; color: #065f46; }
        .result-error { background: #fee2e2; color: #991b1b; }
        .result-testing { background: #fef3c7; color: #92400e; }
        .api-url-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .api-url-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-success { background-color: #10b981; }
        .status-error { background-color: #ef4444; }
        .status-testing { background-color: #f59e0b; }
        .status-unknown { background-color: #6b7280; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-6 max-w-6xl">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">üîß API Connection Debugger</h1>
            <p class="text-gray-600 mb-6">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏´‡∏≤ API URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ToDo List Backend</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Token (‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Login)</label>
                    <input type="text" id="token-input" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" 
                           placeholder="Bearer token ‡∏à‡∏≤‡∏Å localStorage">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Custom API URL</label>
                    <input type="text" id="custom-url-input" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" 
                           placeholder="https://your-backend.vercel.app/api/v1">
                </div>
            </div>
            
            <div class="flex space-x-4 mb-6">
                <button onclick="testAllURLs()" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition">
                    üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö URL ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
                <button onclick="testCustomURL()" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition">
                    üéØ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Custom URL
                </button>
                <button onclick="clearResults()" class="bg-gray-600 text-white px-6 py-2 rounded-md hover:bg-gray-700 transition">
                    üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                </button>
                <button onclick="goBackToTasks()" class="bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700 transition">
                    üìã ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Tasks
                </button>
            </div>
        </div>

        <!-- Test Results -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h2>
            <div id="test-results" class="space-y-3">
                <p class="text-gray-500 text-center py-8">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ó‡∏î‡∏™‡∏≠‡∏ö URL ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
            </div>
        </div>

        <!-- Common API URLs -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">üåê API URLs ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="api-urls-grid">
                <!-- URLs will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Common API URLs to test
        const commonAPIURLs = [
            'https://todo-list-api-grit.vercel.app/api/v1',
            'https://todo-list-api.vercel.app/api/v1',
            'https://to-do-list-api.vercel.app/api/v1',
            'https://daily-palette-api.vercel.app/api/v1',
            'https://todolist-api-backend.vercel.app/api/v1',
            'https://todo-backend-api.vercel.app/api/v1',
            'https://task-management-api.vercel.app/api/v1',
            'https://grit-todo-api.vercel.app/api/v1',
            'https://todo-api-backend.vercel.app/api/v1',
            'https://todoist-clone-api.vercel.app/api/v1'
        ];

        // Load token from localStorage on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedToken = localStorage.getItem('token');
            if (savedToken) {
                document.getElementById('token-input').value = savedToken;
            }
            
            populateAPIURLsGrid();
        });

        function populateAPIURLsGrid() {
            const grid = document.getElementById('api-urls-grid');
            grid.innerHTML = commonAPIURLs.map((url, index) => `
                <div class="api-url-card bg-gray-50 border border-gray-200 rounded-lg p-4" onclick="testSingleURL('${url}')">
                    <div class="flex items-center mb-2">
                        <span class="status-indicator status-unknown" id="status-${index}"></span>
                        <span class="text-sm font-medium text-gray-700">API URL ${index + 1}</span>
                    </div>
                    <p class="text-xs text-gray-600 break-all">${url}</p>
                    <div class="mt-2">
                        <span class="text-xs text-gray-500" id="result-${index}">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
                    </div>
                </div>
            `).join('');
        }

        async function testSingleURL(url) {
            const index = commonAPIURLs.indexOf(url);
            const statusIndicator = document.getElementById(`status-${index}`);
            const resultText = document.getElementById(`result-${index}`);
            
            // Set testing state
            statusIndicator.className = 'status-indicator status-testing';
            resultText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...';
            
            const token = document.getElementById('token-input').value.trim();
            
            try {
                const startTime = Date.now();
                const response = await fetch(`${url}/ping`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': token ? `Bearer ${token}` : ''
                    }
                });
                
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    statusIndicator.className = 'status-indicator status-success';
                    resultText.innerHTML = `‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${responseTime}ms)<br><small class="text-green-600">${data.message || 'OK'}</small>`;
                    
                    // Show copy button for successful URL
                    const card = statusIndicator.closest('.api-url-card');
                    if (!card.querySelector('.copy-btn')) {
                        const copyBtn = document.createElement('button');
                        copyBtn.className = 'copy-btn mt-2 bg-green-100 text-green-800 text-xs px-2 py-1 rounded';
                        copyBtn.textContent = 'üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏ô‡∏µ‡πâ';
                        copyBtn.onclick = (e) => {
                            e.stopPropagation();
                            copyToClipboard(url);
                            saveWorkingURL(url);
                        };
                        card.appendChild(copyBtn);
                    }
                } else {
                    statusIndicator.className = 'status-indicator status-error';
                    resultText.innerHTML = `‚ùå HTTP ${response.status}<br><small class="text-red-600">${response.statusText}</small>`;
                }
            } catch (error) {
                statusIndicator.className = 'status-indicator status-error';
                resultText.innerHTML = `‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ<br><small class="text-red-600">${error.message}</small>`;
            }
        }

        async function testAllURLs() {
            document.getElementById('test-results').innerHTML = '<p class="text-blue-600">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö URL ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î...</p>';
            
            const results = [];
            
            for (let i = 0; i < commonAPIURLs.length; i++) {
                await testSingleURL(commonAPIURLs[i]);
                // Add small delay to avoid overwhelming the server
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            // Update main results section
            const successCount = document.querySelectorAll('.status-success').length;
            const totalCount = commonAPIURLs.length;
            
            document.getElementById('test-results').innerHTML = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-800 mb-2">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
                    <p class="text-blue-700">‡∏ó‡∏î‡∏™‡∏≠‡∏ö URL ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalCount} URLs</p>
                    <p class="text-green-700">‚úÖ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ: ${successCount} URLs</p>
                    <p class="text-red-700">‚ùå ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ${totalCount - successCount} URLs</p>
                    ${successCount > 0 ? '<p class="text-green-600 font-medium mt-2">üéâ ‡∏û‡∏ö URL ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ! ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏ô‡∏µ‡πâ" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>' : '<p class="text-red-600 font-medium mt-2">üòî ‡πÑ‡∏°‡πà‡∏û‡∏ö URL ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á‡∏õ‡πâ‡∏≠‡∏ô Custom URL</p>'}
                </div>
            `;
        }

        async function testCustomURL() {
            const customURL = document.getElementById('custom-url-input').value.trim();
            if (!customURL) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡πâ‡∏≠‡∏ô Custom URL');
                return;
            }
            
            document.getElementById('test-results').innerHTML = '<p class="text-blue-600">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö Custom URL...</p>';
            
            const token = document.getElementById('token-input').value.trim();
            
            try {
                const startTime = Date.now();
                const response = await fetch(`${customURL}/ping`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': token ? `Bearer ${token}` : ''
                    }
                });
                
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('test-results').innerHTML = `
                        <div class="result-success border rounded-lg p-4">
                            <h3 class="font-semibold mb-2">‚úÖ Custom URL ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ!</h3>
                            <p><strong>URL:</strong> ${customURL}</p>
                            <p><strong>Response Time:</strong> ${responseTime}ms</p>
                            <p><strong>Message:</strong> ${data.message || 'OK'}</p>
                            <button onclick="copyToClipboard('${customURL}'); saveWorkingURL('${customURL}')" 
                                    class="mt-3 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                                üìã ‡πÉ‡∏ä‡πâ URL ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ
                            </button>
                        </div>
                    `;
                } else {
                    document.getElementById('test-results').innerHTML = `
                        <div class="result-error border rounded-lg p-4">
                            <h3 class="font-semibold mb-2">‚ùå Custom URL ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</h3>
                            <p><strong>URL:</strong> ${customURL}</p>
                            <p><strong>HTTP Status:</strong> ${response.status} ${response.statusText}</p>
                            <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á:</strong> ${responseTime}ms</p>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('test-results').innerHTML = `
                    <div class="result-error border rounded-lg p-4">
                        <h3 class="font-semibold mb-2">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ</h3>
                        <p><strong>URL:</strong> ${customURL}</p>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p class="text-sm mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</p>
                        <ul class="text-sm list-disc ml-6">
                            <li>URL ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</li>
                            <li>Backend server ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</li>
                            <li>CORS configuration ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</li>
                        </ul>
                    </div>
                `;
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert(`‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡πÅ‡∏•‡πâ‡∏ß: ${text}`);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert(`‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡πÅ‡∏•‡πâ‡∏ß: ${text}`);
            });
        }

        function saveWorkingURL(url) {
            localStorage.setItem('customAPIURL', url);
            localStorage.setItem('apiDebuggerLastWorking', url);
            console.log('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å API URL:', url);
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '<p class="text-gray-500 text-center py-8">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß</p>';
            populateAPIURLsGrid();
        }

        function goBackToTasks() {
            window.location.href = 'tasks.html';
        }

        // Additional debugging functions
        function exportDebugInfo() {
            const debugInfo = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                token: document.getElementById('token-input').value ? 'Present' : 'Missing',
                testedURLs: commonAPIURLs,
                lastWorkingURL: localStorage.getItem('apiDebuggerLastWorking'),
                customAPIURL: localStorage.getItem('customAPIURL')
            };
            
            const blob = new Blob([JSON.stringify(debugInfo, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `api-debug-info-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Auto-load last working URL if exists
        window.addEventListener('load', () => {
            const lastWorking = localStorage.getItem('apiDebuggerLastWorking');
            if (lastWorking) {
                document.getElementById('custom-url-input').value = lastWorking;
                document.getElementById('test-results').innerHTML = `
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <p class="text-blue-800">üí° ‡∏û‡∏ö URL ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <code>${lastWorking}</code></p>
                        <button onclick="testCustomURL()" class="mt-2 bg-blue-600 text-white px-3 py-1 rounded text-sm">
                            ‡∏ó‡∏î‡∏™‡∏≠‡∏ö URL ‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </button>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
