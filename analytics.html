<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - ToDo List App</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçÖ</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="common-notifications.js"></script>
    <style>
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .excel-bg {
            background: #f3f4f6;
            min-height: 100vh;
        }
        
        .nav-professional {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .nav-link {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        
        .nav-link:hover {
            background: #f3f4f6;
        }
        
        .nav-link.active {
            background: #3b82f6;
            color: white;
        }
        
        .coming-soon-card {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .chart-preview {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            opacity: 0.6;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .kpi-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .kpi-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* Loading Styles */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            padding: 40px 20px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid #43e97b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #6b7280;
            font-size: 14px;
        }
        
        /* Enhanced Responsive Design for Mobile & Tablet */
        @media (max-width: 1024px) {
            .container {
                padding: 0 16px;
            }
            
            .nav-professional {
                padding: 12px 16px;
            }
            
            .nav-professional .container {
                flex-direction: column;
                gap: 16px;
            }
            
            .nav-professional h1 {
                font-size: 1.5rem;
            }
            
            .nav-professional .flex.items-center.space-x-2 {
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }
            
            .nav-link {
                padding: 6px 12px;
                font-size: 0.875rem;
            }
            
            .grid.grid-cols-4 {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }
            
            .grid.grid-cols-3 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .grid.grid-cols-2 {
                grid-template-columns: 1fr;
            }
            
            .coming-soon-card {
                padding: 30px 16px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 12px;
            }
            
            .nav-professional {
                padding: 8px 12px;
            }
            
            .nav-professional h1 {
                font-size: 1.25rem;
            }
            
            .nav-link {
                padding: 4px 8px;
                font-size: 0.75rem;
            }
            
            .grid.grid-cols-4,
            .grid.grid-cols-3,
            .grid.grid-cols-2 {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .text-3xl {
                font-size: 1.875rem;
            }
            
            .text-2xl {
                font-size: 1.5rem;
            }
            
            .text-xl {
                font-size: 1.125rem;
            }
            
            .coming-soon-card {
                padding: 20px 12px;
            }
            
            .analytics-card {
                padding: 16px;
            }
            
            .chart-container {
                height: 250px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 8px;
            }
            
            .nav-professional {
                padding: 8px;
            }
            
            .nav-professional h1 {
                font-size: 1rem;
            }
            
            .nav-link {
                padding: 4px 6px;
                font-size: 0.625rem;
            }
            
            .coming-soon-card {
                padding: 16px 8px;
            }
            
            .analytics-card {
                padding: 12px;
            }
            
            .chart-container {
                height: 200px;
            }
            
            .text-lg {
                font-size: 1rem;
            }
            
            .loading-container {
                min-height: 300px;
                padding: 20px 10px;
            }
        }
        
        /* iPad Air specific adjustments */
        @media (min-width: 820px) and (max-width: 1024px) {
            .grid.grid-cols-4 {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .grid.grid-cols-3 {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .grid.grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-4 {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .grid.grid-cols-1.lg\\:grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .grid.grid-cols-1.md\\:grid-cols-3 {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .nav-professional .flex.items-center.space-x-2 {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .coming-soon-card {
                padding: 30px 16px;
            }
        }
        
        /* Goals Analytics responsive */
        @media (max-width: 768px) {
            .grid.grid-cols-1.md\\:grid-cols-4 {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .goal-item {
                padding: 12px;
            }
            
            .goal-item .text-2xl {
                font-size: 1.25rem;
            }
            
            .goal-item .text-lg {
                font-size: 1rem;
            }
        }
        
        @media (max-width: 640px) {
            .grid.grid-cols-1.md\\:grid-cols-4 {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .grid.grid-cols-1.md\\:grid-cols-2 {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .coming-soon-card .grid.grid-cols-2.md\\:grid-cols-4 {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .grid.grid-cols-1.md\\:grid-cols-4 {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .coming-soon-card .grid.grid-cols-2.md\\:grid-cols-4 {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .goal-item {
                padding: 8px;
            }
            
            .bg-white.rounded-lg.p-6 {
                padding: 12px;
            }
            
            .bg-white.rounded-lg.p-4 {
                padding: 8px;
            }
        }
    </style>
</head>
<body class="excel-bg">
    <div id="app" class="min-h-screen">
        <!-- Navigation will be injected here by nav-component.js -->
        <div id="nav-container"></div>

        <!-- Main Content -->
        <div class="container mx-auto p-6">
            <div class="fade-in">
                <!-- Page Header -->
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">üìä Analytics & Reports</h1>
                    <p class="text-gray-600">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                </div>

                <!-- Real-time Analytics Section -->
                <div class="coming-soon-card mb-8" id="analytics-summary-card">
                    <div class="text-6xl mb-4">ÔøΩ</div>
                    <h2 class="text-3xl font-bold mb-4">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h2>
                    <p class="text-lg mb-6">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</p>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                        <div class="bg-white bg-opacity-20 rounded-lg p-3">
                            <div class="font-bold text-lg" id="summary-total-tasks">-</div>
                            <div class="opacity-90">‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-3">
                            <div class="font-bold text-lg" id="summary-completed-tasks">-</div>
                            <div class="opacity-90">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-3">
                            <div class="font-bold text-lg" id="summary-pending-tasks">-</div>
                            <div class="opacity-90">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-3">
                            <div class="font-bold text-lg" id="summary-overdue-tasks">-</div>
                            <div class="opacity-90">‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
                        </div>
                    </div>
                </div>

                <!-- Real-time KPI Cards - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" id="kpi-cards-container">
                    <div class="kpi-card">
                        <div class="kpi-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</div>
                        <div class="kpi-value" id="kpi-productivity">-</div>
                        <div class="text-sm opacity-75">‡∏à‡∏≤‡∏Å‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
                    </div>
                    
                    <div class="kpi-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <div class="kpi-label">‡∏á‡∏≤‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</div>
                        <div class="kpi-value" id="kpi-weekly-tasks">-</div>
                        <div class="text-sm opacity-75">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</div>
                    </div>
                    
                    <div class="kpi-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <div class="kpi-label">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô</div>
                        <div class="kpi-value" id="kpi-avg-time">-</div>
                        <div class="text-sm opacity-75">‡∏ï‡πà‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏á‡∏≤‡∏ô</div>
                    </div>
                    
                    <div class="kpi-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <div class="kpi-label">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</div>
                        <div class="kpi-value" id="kpi-on-time">-</div>
                        <div class="text-sm opacity-75">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ó‡∏±‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
                    </div>
                </div>

                <!-- Goals and Achievements Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Goals Progress -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            üéØ <span class="ml-2">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
                        </h3>
                        <div id="goals-section">
                            <div class="space-y-4">
                                <!-- Weekly Goal -->
                                <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-medium text-gray-700">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</span>
                                        <span class="text-sm text-gray-600" id="weekly-goal-progress">18/25</span>
                                    </div>
                                    <div class="w-full bg-blue-200 rounded-full h-3">
                                        <div class="bg-blue-500 h-3 rounded-full transition-all duration-500" 
                                             style="width: 72%" id="weekly-goal-bar"></div>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô - ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 2 ‡∏ß‡∏±‡∏ô</div>
                                </div>
                                
                                <!-- Monthly Goal -->
                                <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-medium text-gray-700">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                                        <span class="text-sm text-gray-600" id="monthly-goal-progress">89/120</span>
                                    </div>
                                    <div class="w-full bg-green-200 rounded-full h-3">
                                        <div class="bg-green-500 h-3 rounded-full transition-all duration-500" 
                                             style="width: 74%" id="monthly-goal-bar"></div>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô - ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 24 ‡∏ß‡∏±‡∏ô</div>
                                </div>
                                
                                <!-- Productivity Goal -->
                                <div class="border border-purple-200 rounded-lg p-4 bg-purple-50">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-medium text-gray-700">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</span>
                                        <span class="text-sm text-gray-600" id="productivity-goal-progress">84.2%/90%</span>
                                    </div>
                                    <div class="w-full bg-purple-200 rounded-full h-3">
                                        <div class="bg-purple-500 h-3 rounded-full transition-all duration-500" 
                                             style="width: 93%" id="productivity-goal-bar"></div>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û - ‡πÉ‡∏Å‡∏•‡πâ‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Achievements -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            üèÜ <span class="ml-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
                        </h3>
                        <div id="achievements-section">
                            <div class="space-y-3">
                                <div class="flex items-center p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <div class="text-2xl mr-3">üéØ</div>
                                    <div class="flex-1">
                                        <div class="font-medium text-gray-800">Weekly Goal Achieved</div>
                                        <div class="text-sm text-gray-600">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</div>
                                        <div class="text-xs text-gray-500">2 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center p-3 bg-red-50 border border-red-200 rounded-lg">
                                    <div class="text-2xl mr-3">üî•</div>
                                    <div class="flex-1">
                                        <div class="font-medium text-gray-800">Streak Master</div>
                                        <div class="text-sm text-gray-600">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á 10 ‡∏ß‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô</div>
                                        <div class="text-xs text-gray-500">5 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                    <div class="text-2xl mr-3">‚ö°</div>
                                    <div class="flex-1">
                                        <div class="font-medium text-gray-800">Productivity Boost</div>
                                        <div class="text-sm text-gray-600">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Ç‡∏∂‡πâ‡∏ô 15% ‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</div>
                                        <div class="text-xs text-gray-500">1 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Action Button -->
                            <div class="text-center mt-4">
                                <button onclick="window.location.href='profile.html'" 
                                        class="text-blue-500 hover:text-blue-700 text-sm font-medium">
                                    ‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Charts - ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å API -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Productivity Trend Chart -->
                    <div class="chart-preview">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">üìà ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û (30 ‡∏ß‡∏±‡∏ô)</h3>
                        <div class="h-64 bg-gray-100 rounded-lg" id="productivity-chart">
                            <canvas id="productivity-canvas"></canvas>
                        </div>
                    </div>
                    
                    <!-- Task Distribution Chart -->
                    <div class="chart-preview">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">üéØ ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</h3>
                        <div class="h-64 bg-gray-100 rounded-lg" id="priority-chart">
                            <canvas id="priority-canvas"></canvas>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Weekly Performance Chart -->
                    <div class="chart-preview">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">üìä ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h3>
                        <div class="h-64 bg-gray-100 rounded-lg" id="weekly-chart">
                            <canvas id="weekly-canvas"></canvas>
                        </div>
                    </div>
                    
                    <!-- Time Analysis Chart -->
                    <div class="chart-preview">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">‚è∞ ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ß‡∏•‡∏≤</h3>
                        <div class="h-64 bg-gray-100 rounded-lg" id="time-chart">
                            <canvas id="time-canvas"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Goals Performance Section -->
                <div class="bg-white rounded-lg shadow p-6 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-bold text-gray-800">üéØ ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h3>
                        <a href="profile.html" class="text-blue-600 hover:text-blue-800 text-sm">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‚Üí</a>
                    </div>
                    <div id="goals-analytics-section">
                        <!-- Goals analytics will be loaded here -->
                    </div>
                </div>

                <!-- Report Export Section -->
                <div class="mt-8 bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button class="bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 disabled:opacity-50" disabled>
                            üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏£‡∏≤‡∏ü (PDF)
                        </button>
                        <button class="bg-green-500 text-white px-4 py-3 rounded-lg hover:bg-green-600 disabled:opacity-50" disabled>
                            üìà ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Excel)
                        </button>
                        <button class="bg-purple-500 text-white px-4 py-3 rounded-lg hover:bg-purple-600 disabled:opacity-50" disabled>
                            üìã ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (Word)
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let token = localStorage.getItem('token');
        let userData = null;
        let tasksData = [];
        let analyticsData = {};
        const API_BASE = 'https://to-do-list-api-app.vercel.app/api/v1';

        // Utility functions
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const iconMap = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            const bgColorMap = {
                success: 'from-green-500 to-green-600',
                error: 'from-red-500 to-red-600',
                warning: 'from-yellow-500 to-yellow-600',
                info: 'from-blue-500 to-blue-600'
            };

            toast.className = `
                fixed top-4 right-4 bg-gradient-to-r ${bgColorMap[type]} 
                text-white px-6 py-4 rounded-xl shadow-2xl z-50 
                transform transition-all duration-300 translate-x-full opacity-0
                min-w-80 max-w-md
            `;
            
            toast.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <span class="text-lg">${iconMap[type]}</span>
                        </div>
                    </div>
                    <div class="flex-1">
                        <p class="font-medium text-sm leading-relaxed">${message}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="flex-shrink-0 text-white hover:text-gray-200 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
            }, 100);

            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 5000);
        }

        async function apiCall(endpoint, options = {}) {
            const config = {
                method: options.method || 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    ...(token && { 'Authorization': `Bearer ${token}` })
                },
                ...(options.body && { body: options.body }),
                ...options
            };

            const response = await fetch(`${API_BASE}${endpoint}`, config);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            return await response.json();
        }
        
        function showLoading(text = 'Loading analytics...') {
            const content = document.querySelector('.fade-in');
            const existingLoading = content.querySelector('.loading-container');
            if (existingLoading) {
                existingLoading.querySelector('.loading-text').textContent = text;
                return;
            }
            
            const loadingHtml = `
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">${text}</div>
                </div>
            `;
            
            // Insert loading after page header
            const pageHeader = content.querySelector('.mb-8');
            if (pageHeader) {
                pageHeader.insertAdjacentHTML('afterend', loadingHtml);
                // Hide all other content
                const sections = content.querySelectorAll('.coming-soon-card, .grid, .bg-white');
                sections.forEach(section => {
                    if (section) section.style.display = 'none';
                });
            }
        }
        
        function hideLoading() {
            const loading = document.querySelector('.loading-container');
            if (loading) loading.remove();
            
            // Show original content
            const sections = document.querySelectorAll('.coming-soon-card, .grid, .bg-white');
            sections.forEach(section => {
                if (section) section.style.display = section.classList.contains('grid') ? 'grid' : 'block';
            });
        }

        // Data loading functions
        async function loadUserInfo() {
            try {
                showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...');
                const userInfo = await apiCall('/user/info');
                userData = userInfo.user;
                
                const greetingEl = document.getElementById('user-greeting');
                if (greetingEl && userData) {
                    greetingEl.textContent = `Welcome, ${userData.username}`;
                }
                
                showToast(`‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${userData.username}!`, 'success');
                return userInfo;
            } catch (error) {
                console.warn('Failed to load user info:', error);
                showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ', 'warning');
                
                // Set default user info
                userData = { username: 'User', id: 1 };
                const greetingEl = document.getElementById('user-greeting');
                if (greetingEl) {
                    greetingEl.textContent = 'Welcome, User';
                }
                return { user: userData };
            }
        }

        async function loadAnalyticsOverview() {
            try {
                showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...');
                
                // Try real API first
                try {
                    const overview = await apiCall('/analytics/overview');
                    if (overview) {
                        return overview;
                    }
                } catch (error) {
                    console.warn('API not available, using enhanced demo data');
                }
                
                // Enhanced demo data with realistic goals and targets
                const demoOverview = {
                    productivity_score: 84.2,
                    weekly_velocity: 23,
                    average_focus_time: 4.8,
                    on_time_rate: 76.5,
                    total_tasks: 156,
                    completed_tasks: 119,
                    pending_tasks: 23,
                    overdue_tasks: 14,
                    priority_distribution: { high: 28, medium: 56, low: 72 },
                    goals: {
                        weekly_target: {
                            title: "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ",
                            current: 18,
                            target: 25,
                            deadline: "‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå"
                        },
                        monthly_target: {
                            title: "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", 
                            current: 89,
                            target: 120,
                            deadline: "‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"
                        },
                        productivity_goal: {
                            title: "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û",
                            current: 84.2,
                            target: 90.0,
                            unit: "%"
                        }
                    },
                    achievements: {
                        recent: [
                            { icon: 'üèÜ', title: 'Weekly Goal', description: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå', date: '2024-01-15' },
                            { icon: 'üî•', title: 'Streak Master', description: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á 10 ‡∏ß‡∏±‡∏ô', date: '2024-01-12' }
                        ]
                    },
                    trends: {
                        last_7_days: [72, 68, 81, 85, 79, 88, 84],
                        improvement: 15.3 // percentage vs last week
                    }
                };
                
                return demoOverview;
                
            } catch (error) {
                console.warn('Failed to load analytics overview:', error);
                showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ', 'warning');
                return null;
            }
        }

        async function loadTaskAnalytics() {
            try {
                showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏á‡∏≤‡∏ô...');
                
                // Try real API first
                try {
                    const taskAnalytics = await apiCall('/analytics/tasks');
                    if (taskAnalytics) {
                        return taskAnalytics;
                    }
                } catch (error) {
                    console.warn('API not available, using enhanced demo data');
                }
                
                // Enhanced demo task analytics with goals and targets
                const demoTaskAnalytics = {
                    completion_rate: 78.5,
                    total_tasks: 156,
                    completed_tasks: 119,
                    pending_tasks: 23,
                    overdue_tasks: 14,
                    in_progress_tasks: 0,
                    average_completion_time: 2.8, // hours
                    priority_breakdown: {
                        high: { total: 28, completed: 21, percentage: 75.0 },
                        medium: { total: 56, completed: 45, percentage: 80.4 },
                        low: { total: 72, completed: 53, percentage: 73.6 }
                    },
                    category_performance: {
                        'Work': { completion_rate: 82.3, avg_time: 3.2 },
                        'Personal': { completion_rate: 74.1, avg_time: 2.1 },
                        'Learning': { completion_rate: 85.7, avg_time: 4.8 },
                        'Health': { completion_rate: 67.9, avg_time: 1.5 }
                    },
                    weekly_stats: {
                        current_week: 18,
                        last_week: 16,
                        improvement: 12.5,
                        target: 25
                    },
                    monthly_stats: {
                        current_month: 89,
                        last_month: 76,
                        improvement: 17.1,
                        target: 120
                    },
                    time_analytics: {
                        most_productive_hour: 10,
                        least_productive_hour: 15,
                        average_task_duration: 2.8,
                        focus_sessions_completed: 67
                    }
                };
                
                return demoTaskAnalytics;
                
            } catch (error) {
                console.warn('Failed to load task analytics:', error);
                showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ', 'warning');
                return null;
            }
        }

        async function loadWeeklyPerformance() {
            try {
                const performance = await apiCall('/analytics/performance/weekly');
                return performance;
            } catch (error) {
                console.warn('Failed to load weekly performance:', error);
                return null;
            }
        }

        async function loadMonthlyPerformance() {
            try {
                const performance = await apiCall('/analytics/performance/monthly');
                return performance;
            } catch (error) {
                console.warn('Failed to load monthly performance:', error);
                return null;
            }
        }

        async function loadProductivityTrends() {
            try {
                const trends = await apiCall('/analytics/productivity-trends');
                return trends;
            } catch (error) {
                console.warn('Failed to load productivity trends:', error);
                return null;
            }
        }

        async function loadTimeAllocation() {
            try {
                const timeAllocation = await apiCall('/analytics/time-allocation');
                return timeAllocation;
            } catch (error) {
                console.warn('Failed to load time allocation:', error);
                return null;
            }
        }

        async function loadTasks() {
            try {
                showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô...');
                const response = await apiCall('/tasks');
                tasksData = response.tasks || response || [];
                showToast(`‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (${tasksData.length} ‡∏á‡∏≤‡∏ô)`, 'success');
                return tasksData;
            } catch (error) {
                console.warn('Failed to load tasks:', error);
                showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ', 'error');
                tasksData = [];
                return tasksData;
            }
        }

        // Analytics calculation functions
        function calculateAnalytics(overviewData, taskAnalyticsData) {
            showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...');
            
            // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API ‡∏´‡∏≤‡∏Å‡∏°‡∏µ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô
            if (overviewData) {
                analyticsData = {
                    productivityScore: overviewData.productivity_score || 0,
                    weeklyVelocity: overviewData.weekly_velocity || 0,
                    averageFocusTime: overviewData.average_focus_time || 0,
                    onTimeRate: overviewData.on_time_rate || 0,
                    totalTasks: overviewData.total_tasks || 0,
                    completedTasks: overviewData.completed_tasks || 0,
                    overdueTasks: overviewData.overdue_tasks || 0,
                    priorityDistribution: overviewData.priority_distribution || { high: 0, medium: 0, low: 0 }
                };
                return analyticsData;
            }
            
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ API data ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å tasks
            if (tasksData.length === 0) {
                analyticsData = {
                    productivityScore: 0,
                    weeklyVelocity: 0,
                    averageFocusTime: 0,
                    onTimeRate: 0,
                    totalTasks: 0,
                    completedTasks: 0,
                    overdueTasks: 0,
                    priorityDistribution: { high: 0, medium: 0, low: 0 }
                };
                return analyticsData;
            }
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• tasks
            const totalTasks = tasksData.length;
            const completedTasks = tasksData.filter(t => t.is_completed).length;
            const productivityScore = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏á‡∏≤‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ
            const now = new Date();
            const weekStart = new Date(now.setDate(now.getDate() - now.getDay()));
            const weeklyCompleted = tasksData.filter(t => {
                if (!t.is_completed || !t.updated_at) return false;
                const completedDate = new Date(t.updated_at);
                return completedDate >= weekStart;
            }).length;
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            const today = new Date();
            const overdueTasks = tasksData.filter(t => {
                if (t.is_completed || !t.due_date) return false;
                return new Date(t.due_date) < today;
            }).length;
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
            const tasksWithDueDate = tasksData.filter(t => t.due_date && t.is_completed);
            const onTimeTasks = tasksWithDueDate.filter(t => {
                const dueDate = new Date(t.due_date);
                const completedDate = new Date(t.updated_at);
                return completedDate <= dueDate;
            });
            const onTimeRate = tasksWithDueDate.length > 0 ? Math.round((onTimeTasks.length / tasksWithDueDate.length) * 100) : 100;
            
            // ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
            const priorityDistribution = {
                high: tasksData.filter(t => t.priority === 3).length,
                medium: tasksData.filter(t => t.priority === 2).length,
                low: tasksData.filter(t => t.priority === 1).length
            };
            
            analyticsData = {
                productivityScore,
                weeklyVelocity: weeklyCompleted,
                averageFocusTime: "2.5h", // ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô API
                onTimeRate,
                totalTasks,
                completedTasks,
                overdueTasks,
                priorityDistribution
            };
            
            return analyticsData;
        }

            // Fallback: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡πà‡∏≤
            if (!tasksData.length) {
                analyticsData = {
                    productivityScore: 0,
                    weeklyVelocity: 0,
                    averageFocusTime: 0,
                    onTimeRate: 0,
                    totalTasks: 0,
                    completedTasks: 0,
                    overdueTasks: 0,
                    priorityDistribution: { high: 0, medium: 0, low: 0 }
                };
                return analyticsData;
            }

            const totalTasks = tasksData.length;
            const completedTasks = tasksData.filter(task => task.is_completed).length;
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            const today = new Date(2025, 7, 7); // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (7 ‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏° 2568)
            const overdueTasks = tasksData.filter(task => {
                if (!task.due_date || task.is_completed) return false;
                const taskDate = new Date(task.due_date);
                return taskDate < today;
            }).length;

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏á‡∏≤‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            const weeklyCompletedTasks = tasksData.filter(task => {
                if (!task.is_completed || !task.updated_at) return false;
                const completedDate = new Date(task.updated_at);
                return completedDate >= startOfWeek && completedDate <= endOfWeek;
            }).length;

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Productivity Score
            const productivityScore = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì On-Time Rate
            const tasksWithDueDate = tasksData.filter(task => task.due_date && task.is_completed);
            const onTimeTasks = tasksWithDueDate.filter(task => {
                const dueDate = new Date(task.due_date);
                const completedDate = new Date(task.updated_at || task.created_at);
                return completedDate <= dueDate;
            }).length;
            const onTimeRate = tasksWithDueDate.length > 0 ? Math.round((onTimeTasks / tasksWithDueDate.length) * 100) : 0;

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á Priority
            const priorityDistribution = {
                high: tasksData.filter(task => task.priority === 3).length,
                medium: tasksData.filter(task => task.priority === 2).length,
                low: tasksData.filter(task => task.priority === 1).length
            };

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏™‡∏°‡∏°‡∏ï‡∏¥)
            const averageFocusTime = completedTasks > 0 ? Math.round((completedTasks * 2.5) / completedTasks * 10) / 10 : 0;

            analyticsData = {
                productivityScore,
                weeklyVelocity: weeklyCompletedTasks,
                averageFocusTime,
                onTimeRate,
                totalTasks,
                completedTasks,
                overdueTasks,
                priorityDistribution
            };

            return analyticsData;

        // UI Update functions
        // Enhanced KPI Cards Update with Goals and Targets
        function updateKPICards() {
            // Update KPI Cards with real API data or enhanced demo data
            const productivityEl = document.getElementById('kpi-productivity');
            if (productivityEl && analyticsData) {
                const productivity = analyticsData.productivityScore || 0;
                const productivityTarget = 90; // Target: 90%
                
                productivityEl.textContent = `${productivity.toFixed(1)}%`;
                
                // Add progress indicator
                const cardEl = productivityEl.closest('.kpi-card');
                if (cardEl) {
                    // Remove existing progress bar
                    const existingProgress = cardEl.querySelector('.progress-bar');
                    if (existingProgress) existingProgress.remove();
                    
                    // Add new progress bar and target info
                    const progressBar = document.createElement('div');
                    progressBar.className = 'progress-bar mt-2';
                    progressBar.innerHTML = `
                        <div class="flex justify-between text-xs opacity-75 mb-1">
                            <span>‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</span>
                            <span>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${productivityTarget}%</span>
                        </div>
                        <div class="w-full bg-white bg-opacity-30 rounded-full h-2">
                            <div class="bg-white h-2 rounded-full transition-all duration-500" 
                                 style="width: ${Math.min((productivity / productivityTarget) * 100, 100)}%"></div>
                        </div>
                    `;
                    cardEl.appendChild(progressBar);
                }
            }

            const weeklyEl = document.getElementById('kpi-weekly-tasks');
            if (weeklyEl && analyticsData) {
                const weeklyTasks = analyticsData.weeklyVelocity || 0;
                const weeklyTarget = 25; // Target: 25 tasks per week
                
                weeklyEl.textContent = `${weeklyTasks}/${weeklyTarget}`;
                
                const cardEl = weeklyEl.closest('.kpi-card');
                if (cardEl) {
                    const existingProgress = cardEl.querySelector('.progress-bar');
                    if (existingProgress) existingProgress.remove();
                    
                    const progressBar = document.createElement('div');
                    progressBar.className = 'progress-bar mt-2';
                    progressBar.innerHTML = `
                        <div class="flex justify-between text-xs opacity-75 mb-1">
                            <span>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</span>
                            <span>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${weeklyTarget}</span>
                        </div>
                        <div class="w-full bg-white bg-opacity-30 rounded-full h-2">
                            <div class="bg-white h-2 rounded-full transition-all duration-500" 
                                 style="width: ${Math.min((weeklyTasks / weeklyTarget) * 100, 100)}%"></div>
                        </div>
                    `;
                    cardEl.appendChild(progressBar);
                }
            }

            const avgTimeEl = document.getElementById('kpi-avg-time');
            if (avgTimeEl && analyticsData) {
                const avgTime = analyticsData.averageFocusTime || 0;
                const timeTarget = 6; // Target: 6 hours focus time per day
                
                avgTimeEl.textContent = `${avgTime.toFixed(1)}h`;
                
                const cardEl = avgTimeEl.closest('.kpi-card');
                if (cardEl) {
                    const existingProgress = cardEl.querySelector('.progress-bar');
                    if (existingProgress) existingProgress.remove();
                    
                    const progressBar = document.createElement('div');
                    progressBar.className = 'progress-bar mt-2';
                    progressBar.innerHTML = `
                        <div class="flex justify-between text-xs opacity-75 mb-1">
                            <span>‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</span>
                            <span>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${timeTarget}h</span>
                        </div>
                        <div class="w-full bg-white bg-opacity-30 rounded-full h-2">
                            <div class="bg-white h-2 rounded-full transition-all duration-500" 
                                 style="width: ${Math.min((avgTime / timeTarget) * 100, 100)}%"></div>
                        </div>
                    `;
                    cardEl.appendChild(progressBar);
                }
            }

            const onTimeEl = document.getElementById('kpi-on-time');
            if (onTimeEl && analyticsData) {
                const onTimeRate = analyticsData.onTimeRate || 0;
                const onTimeTarget = 85; // Target: 85% on-time completion
                
                onTimeEl.textContent = `${onTimeRate.toFixed(1)}%`;
                
                const cardEl = onTimeEl.closest('.kpi-card');
                if (cardEl) {
                    const existingProgress = cardEl.querySelector('.progress-bar');
                    if (existingProgress) existingProgress.remove();
                    
                    const progressBar = document.createElement('div');
                    progressBar.className = 'progress-bar mt-2';
                    progressBar.innerHTML = `
                        <div class="flex justify-between text-xs opacity-75 mb-1">
                            <span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</span>
                            <span>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${onTimeTarget}%</span>
                        </div>
                        <div class="w-full bg-white bg-opacity-30 rounded-full h-2">
                            <div class="bg-white h-2 rounded-full transition-all duration-500" 
                                 style="width: ${Math.min((onTimeRate / onTimeTarget) * 100, 100)}%"></div>
                        </div>
                    `;
                    cardEl.appendChild(progressBar);
                }
            }
        }

        function updateSummaryCard() {
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ
            const totalTasksEl = document.getElementById('summary-total-tasks');
            const completedTasksEl = document.getElementById('summary-completed-tasks');
            const pendingTasksEl = document.getElementById('summary-pending-tasks');
            const overdueTasksEl = document.getElementById('summary-overdue-tasks');

            if (totalTasksEl) totalTasksEl.textContent = analyticsData.totalTasks;
            if (completedTasksEl) completedTasksEl.textContent = analyticsData.completedTasks;
            if (pendingTasksEl) pendingTasksEl.textContent = analyticsData.totalTasks - analyticsData.completedTasks;
            if (overdueTasksEl) overdueTasksEl.textContent = analyticsData.overdueTasks;
        }

        function createProductivityChart() {
            const chartContainer = document.querySelector('.chart-preview:nth-of-type(1) .bg-gray-100');
            if (!chartContainer) return;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏≤‡§´ 30 ‡∏ß‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
            const days = [];
            const productivityData = [];
            const today = new Date(2025, 7, 7); // 7 ‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏° 2568
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                days.push(date.toLocaleDateString('th-TH', { day: 'numeric', month: 'short' }));
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                const dailyTasks = tasksData.filter(task => {
                    if (!task.updated_at) return false;
                    const taskDate = new Date(task.updated_at);
                    return taskDate.toDateString() === date.toDateString();
                });
                
                if (dailyTasks.length > 0) {
                    const completed = dailyTasks.filter(task => task.is_completed).length;
                    productivityData.push(Math.round((completed / dailyTasks.length) * 100));
                } else {
                    // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏°‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
                    productivityData.push(Math.floor(Math.random() * 30) + 70); // 70-100%
                }
            }

            chartContainer.innerHTML = `
                <canvas id="productivityChart" width="400" height="200"></canvas>
            `;

            const ctx = document.getElementById('productivityChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Productivity %',
                        data: productivityData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxTicksLimit: 8
                            }
                        }
                    }
                }
            });
        }

        function createPriorityChart() {
            const chartContainer = document.querySelector('.chart-preview:nth-of-type(2) .bg-gray-100');
            if (!chartContainer) return;

            chartContainer.innerHTML = `
                <canvas id="priorityChart" width="400" height="200"></canvas>
            `;

            const ctx = document.getElementById('priorityChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏π‡∏á', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ï‡πà‡∏≥'],
                    datasets: [{
                        data: [
                            analyticsData.priorityDistribution.high,
                            analyticsData.priorityDistribution.medium,
                            analyticsData.priorityDistribution.low
                        ],
                        backgroundColor: [
                            '#ef4444',
                            '#f59e0b',
                            '#10b981'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function createWeeklyChart() {
            const chartContainer = document.querySelector('.chart-preview:nth-of-type(3) .bg-gray-100');
            if (!chartContainer) return;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏≤‡¶´‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 8 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
            const weeks = [];
            const weeklyData = [];
            const today = new Date(2025, 7, 7);
            
            for (let i = 7; i >= 0; i--) {
                const weekStart = new Date(today);
                weekStart.setDate(today.getDate() - (i * 7) - today.getDay());
                weeks.push(`‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ${8-i}`);
                
                // ‡∏ô‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏±‡πâ‡∏ô
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                
                const weeklyCompleted = tasksData.filter(task => {
                    if (!task.is_completed || !task.updated_at) return false;
                    const completedDate = new Date(task.updated_at);
                    return completedDate >= weekStart && completedDate <= weekEnd;
                }).length;
                
                // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏°‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                weeklyData.push(weeklyCompleted > 0 ? weeklyCompleted : Math.floor(Math.random() * 8) + 2);
            }

            chartContainer.innerHTML = `
                <canvas id="weeklyChart" width="400" height="200"></canvas>
            `;

            const ctx = document.getElementById('weeklyChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: weeks,
                    datasets: [{
                        label: '‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à',
                        data: weeklyData,
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: '#667eea',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function createTimeAnalysisChart() {
            const chartContainer = document.querySelector('.chart-preview:nth-of-type(4) .bg-gray-100');
            if (!chartContainer) return;

            // ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô (‡∏™‡∏°‡∏°‡∏ï‡∏¥)
            const timeData = {
                '‡∏á‡∏≤‡∏ô‡∏î‡πà‡∏ß‡∏ô': analyticsData.priorityDistribution.high * 1.5,
                '‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥': analyticsData.priorityDistribution.medium * 2.0,
                '‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô': analyticsData.priorityDistribution.low * 1.0,
                '‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ': Math.max(0, analyticsData.totalTasks - Object.values(analyticsData.priorityDistribution).reduce((a, b) => a + b, 0)) * 1.2
            };

            chartContainer.innerHTML = `
                <canvas id="timeChart" width="400" height="200"></canvas>
            `;

            const ctx = document.getElementById('timeChart').getContext('2d');
            new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: Object.keys(timeData),
                    datasets: [{
                        data: Object.values(timeData),
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(99, 102, 241, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Main analytics loading function
        async function loadAnalytics() {
            try {
                showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...');
                
                // Step 1: Load user info first (priority)
                await loadUserInfo();
                
                // Step 2: Load tasks data
                await loadTasks();
                
                // Step 3: Calculate analytics
                calculateAnalytics();
                
                // Step 4: Update UI with real data
                showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠...');
                updateKPICards();
                updateSummaryCard();
                
                // Step 5: Create charts
                showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡¶´...');
                setTimeout(() => {
                    createProductivityChart();
                    createPriorityChart();
                    createWeeklyChart();
                    createTimeAnalysisChart();
                    
                    // Enable export buttons
                    const exportButtons = document.querySelectorAll('.bg-white button[disabled]');
                    exportButtons.forEach(button => {
                        button.disabled = false;
                        button.classList.remove('disabled:opacity-50');
                        button.addEventListener('click', handleExport);
                    });
                    
                    hideLoading();
                    showToast('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', 'success');
                }, 1000);
                
            } catch (error) {
                console.error('Error loading analytics:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
                hideLoading();
            }
        }

        // Export functions
        function handleExport(event) {
            const button = event.target;
            const buttonText = button.textContent.trim();
            
            if (buttonText.includes('PDF')) {
                exportToPDF();
            } else if (buttonText.includes('Excel')) {
                exportToExcel();
            } else if (buttonText.includes('Word')) {
                exportToWord();
            }
        }

        function exportToPDF() {
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF...', 'info');
            // TODO: Implement PDF export
            setTimeout(() => {
                showToast('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            }, 2000);
        }

        function exportToExcel() {
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Excel...', 'info');
            // TODO: Implement Excel export
            setTimeout(() => {
                showToast('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            }, 2000);
        }

        function exportToWord() {
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Word...', 'info');
            // TODO: Implement Word export
            setTimeout(() => {
                showToast('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Word ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            }, 2000);
        }



        // Export functions

        function startPomodoroTimer(seconds) {
            // Simple timer implementation
            let remainingTime = seconds;
            const timer = setInterval(() => {
                const minutes = Math.floor(remainingTime / 60);
                const secs = remainingTime % 60;
                
                // Update button text with timer
                const pomodoroBtn = document.querySelector('button[onclick="startPomodoroSession()"]');
                if (pomodoroBtn) {
                    pomodoroBtn.textContent = `üçÖ ${minutes}:${secs.toString().padStart(2, '0')}`;
                }
                
                remainingTime--;
                
                if (remainingTime < 0) {
                    clearInterval(timer);
                    completePomodoroSession();
                    if (pomodoroBtn) {
                        pomodoroBtn.textContent = 'üçÖ ‡πÄ‡∏£‡∏¥‡πà‡∏° Pomodoro';
                    }
                }
            }, 1000);
        }

        async function completePomodoroSession() {
            try {
                const response = await apiCall('/focus/pomodoro/complete', {
                    method: 'POST'
                });
                
                if (response.success) {
                    showToast('üéâ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô Pomodoro!', 'success');
                    // Refresh stats
                    const pomodoroStats = await loadPomodoroStats();
                    updatePomodoroStats(pomodoroStats);
                }
            } catch (error) {
                console.error('Error completing pomodoro session:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô', 'warning');
            }
        }

        function viewPomodoroHistory() {
            showToast('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ Pomodoro ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤', 'info');
            // TODO: Implement Pomodoro history view
        }
        
        function logout() {
            if (confirmLogout) {
                confirmLogout();
            } else {
                localStorage.removeItem('token');
                window.location.href = 'index.html';
            }
        }
        
        // Initialize analytics page
        async function initAnalytics() {
            // Check authentication first
            if (!token) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô', 'warning');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
                return;
            }
            
            // Start loading analytics data
            await loadAnalytics();
            
            // Load goals analytics
            loadGoalsAnalytics();
        }
        
        // Goals Analytics Functions
        function loadGoalsAnalytics() {
            try {
                const userGoals = JSON.parse(localStorage.getItem('userGoals') || '[]');
                const goalsAnalyticsSection = document.getElementById('goals-analytics-section');
                
                if (!goalsAnalyticsSection) return;
                
                if (userGoals.length === 0) {
                    goalsAnalyticsSection.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <div class="text-4xl mb-3">üéØ</div>
                            <p class="text-lg mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</p>
                            <p class="text-sm mb-4">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</p>
                            <a href="profile.html" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                                ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏£‡∏Å
                            </a>
                        </div>
                    `;
                    return;
                }
                
                // Calculate analytics
                const analytics = calculateGoalsAnalytics(userGoals);
                
                // Render analytics
                goalsAnalyticsSection.innerHTML = `
                    <!-- Goals Overview -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-blue-600">${analytics.totalGoals}</div>
                            <div class="text-sm text-gray-600">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-green-600">${analytics.completedGoals}</div>
                            <div class="text-sm text-gray-600">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
                        </div>
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-yellow-600">${analytics.inProgressGoals}</div>
                            <div class="text-sm text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
                        </div>
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-purple-600">${analytics.averageProgress.toFixed(1)}%</div>
                            <div class="text-sm text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
                        </div>
                    </div>
                    
                    <!-- Individual Goals Performance -->
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-700 mb-3">üìà ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h4>
                        ${renderGoalsPerformance(userGoals)}
                    </div>
                    
                    <!-- Goals Insights -->
                    <div class="mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200">
                        <h4 class="font-medium text-gray-800 mb-3">üí° ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${generateGoalsInsights(analytics, userGoals)}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading goals analytics:', error);
                const goalsAnalyticsSection = document.getElementById('goals-analytics-section');
                if (goalsAnalyticsSection) {
                    goalsAnalyticsSection.innerHTML = `
                        <div class="text-center text-red-500 py-6">
                            <p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</p>
                        </div>
                    `;
                }
            }
        }

        function calculateGoalsAnalytics(goals) {
            const totalGoals = goals.length;
            const completedGoals = goals.filter(goal => (goal.progress / goal.target) >= 1).length;
            const inProgressGoals = totalGoals - completedGoals;
            const totalProgress = goals.reduce((sum, goal) => sum + (goal.progress / goal.target) * 100, 0);
            const averageProgress = totalGoals > 0 ? totalProgress / totalGoals : 0;
            
            return {
                totalGoals,
                completedGoals,
                inProgressGoals,
                averageProgress
            };
        }

        function renderGoalsPerformance(goals) {
            return goals.map((goal, index) => {
                const progressPercent = Math.round((goal.progress / goal.target) * 100);
                const isCompleted = progressPercent >= 100;
                const statusColor = isCompleted ? 'green' : progressPercent >= 70 ? 'yellow' : progressPercent >= 40 ? 'blue' : 'red';
                const performance = getPerformanceLevel(progressPercent);
                
                return `
                    <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center">
                                <span class="text-xl mr-3">${goal.icon}</span>
                                <div>
                                    <div class="font-medium text-gray-800">${goal.title}</div>
                                    <div class="text-sm text-gray-600">${goal.description}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold text-${statusColor}-600">${progressPercent}%</div>
                                <div class="text-xs text-gray-500">${performance}</div>
                            </div>
                        </div>
                        
                        <div class="mb-2">
                            <div class="flex justify-between text-sm text-gray-600 mb-1">
                                <span>${goal.progress}/${goal.target}</span>
                                ${goal.deadline ? `<span>‚è∞ ${goal.deadline}</span>` : ''}
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-${statusColor}-500 h-3 rounded-full transition-all duration-500" 
                                     style="width: ${Math.min(progressPercent, 100)}%"></div>
                            </div>
                        </div>
                        
                        ${isCompleted ? `
                            <div class="flex items-center text-green-600 text-sm mt-2">
                                <span class="mr-1">üéâ</span>
                                ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!
                            </div>
                        ` : progressPercent >= 80 ? `
                            <div class="flex items-center text-yellow-600 text-sm mt-2">
                                <span class="mr-1">üî•</span>
                                ‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function getPerformanceLevel(progressPercent) {
            if (progressPercent >= 100) return '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
            if (progressPercent >= 80) return '‡∏î‡∏µ‡∏°‡∏≤‡∏Å';
            if (progressPercent >= 60) return '‡∏î‡∏µ';
            if (progressPercent >= 40) return '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á';
            if (progressPercent >= 20) return '‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á';
            return '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô';
        }

        function generateGoalsInsights(analytics, goals) {
            const insights = [];
            
            // Completion rate insight
            const completionRate = (analytics.completedGoals / analytics.totalGoals) * 100;
            insights.push(`
                <div class="bg-white rounded-lg p-4 border border-blue-200">
                    <div class="font-medium text-gray-800 mb-2">üìä ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
                    <div class="text-sm text-gray-600">
                        ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${completionRate.toFixed(1)}% ‡∏Ç‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        ${completionRate >= 70 ? '- ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!' : completionRate >= 50 ? '- ‡∏î‡∏µ‡∏°‡∏≤‡∏Å!' : '- ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á'}
                    </div>
                </div>
            `);
            
            // Progress insight
            if (analytics.averageProgress >= 80) {
                insights.push(`
                    <div class="bg-white rounded-lg p-4 border border-green-200">
                        <div class="font-medium text-gray-800 mb-2">üöÄ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°</div>
                        <div class="text-sm text-gray-600">
                            ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${analytics.averageProgress.toFixed(1)}% ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å!
                        </div>
                    </div>
                `);
            } else if (analytics.averageProgress >= 50) {
                insights.push(`
                    <div class="bg-white rounded-lg p-4 border border-yellow-200">
                        <div class="font-medium text-gray-800 mb-2">‚ö° ‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</div>
                        <div class="text-sm text-gray-600">
                            ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${analytics.averageProgress.toFixed(1)}% - ‡∏•‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
                        </div>
                    </div>
                `);
            } else {
                insights.push(`
                    <div class="bg-white rounded-lg p-4 border border-red-200">
                        <div class="font-medium text-gray-800 mb-2">üí™ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà</div>
                        <div class="text-sm text-gray-600">
                            ‡∏•‡∏≠‡∏á‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏µ‡πà‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô
                        </div>
                    </div>
                `);
            }
            
            return insights.join('');
        }

        // Update Goals and Achievements Section with Real API Data
        function updateGoalsAndAchievements(overviewData) {
            // Update goals from API data or use demo data
            const goals = overviewData?.goals || {
                weekly_target: { current: 18, target: 25 },
                monthly_target: { current: 89, target: 120 },
                productivity_goal: { current: 84.2, target: 90.0 }
            };
            
            // Update weekly goal
            const weeklyProgress = document.getElementById('weekly-goal-progress');
            const weeklyBar = document.getElementById('weekly-goal-bar');
            if (weeklyProgress && weeklyBar) {
                weeklyProgress.textContent = `${goals.weekly_target.current}/${goals.weekly_target.target}`;
                const weeklyPercent = (goals.weekly_target.current / goals.weekly_target.target) * 100;
                weeklyBar.style.width = `${Math.min(weeklyPercent, 100)}%`;
            }
            
            // Update monthly goal
            const monthlyProgress = document.getElementById('monthly-goal-progress');
            const monthlyBar = document.getElementById('monthly-goal-bar');
            if (monthlyProgress && monthlyBar) {
                monthlyProgress.textContent = `${goals.monthly_target.current}/${goals.monthly_target.target}`;
                const monthlyPercent = (goals.monthly_target.current / goals.monthly_target.target) * 100;
                monthlyBar.style.width = `${Math.min(monthlyPercent, 100)}%`;
            }
            
            // Update productivity goal
            const productivityProgress = document.getElementById('productivity-goal-progress');
            const productivityBar = document.getElementById('productivity-goal-bar');
            if (productivityProgress && productivityBar) {
                productivityProgress.textContent = `${goals.productivity_goal.current}%/${goals.productivity_goal.target}%`;
                const productivityPercent = (goals.productivity_goal.current / goals.productivity_goal.target) * 100;
                productivityBar.style.width = `${Math.min(productivityPercent, 100)}%`;
            }
            
            // Update achievements from API data
            const achievements = overviewData?.achievements?.recent || [
                { icon: 'üéØ', title: 'Weekly Goal Achieved', description: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå', date: '2 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß' },
                { icon: 'üî•', title: 'Streak Master', description: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á 10 ‡∏ß‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô', date: '5 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß' },
                { icon: '‚ö°', title: 'Productivity Boost', description: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Ç‡∏∂‡πâ‡∏ô 15% ‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ', date: '1 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß' }
            ];
            
            const achievementsSection = document.getElementById('achievements-section');
            if (achievementsSection) {
                const achievementsHtml = achievements.map(achievement => `
                    <div class="flex items-center p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg">
                        <div class="text-2xl mr-3">${achievement.icon}</div>
                        <div class="flex-1">
                            <div class="font-medium text-gray-800">${achievement.title}</div>
                            <div class="text-sm text-gray-600">${achievement.description}</div>
                            <div class="text-xs text-gray-500">${achievement.date}</div>
                        </div>
                    </div>
                `).join('');
                
                achievementsSection.innerHTML = `
                    <div class="space-y-3">
                        ${achievementsHtml}
                    </div>
                    <div class="text-center mt-4">
                        <button onclick="window.location.href='profile.html'" 
                                class="text-blue-500 hover:text-blue-700 text-sm font-medium">
                            ‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí
                        </button>
                    </div>
                `;
            }
        }
        
        // Main analytics loading function
        async function loadAnalytics() {
            try {
                showGlobalLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...');
                
                // Step 1: Load user info
                updateGlobalLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...');
                await loadUserInfo();
                
                // Step 2: Load tasks data (required for calculations)
                updateGlobalLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô...');
                await loadTasks();
                
                // Step 3: Try to load analytics from API
                updateGlobalLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å API...');
                const overviewData = await loadAnalyticsOverview();
                const taskAnalyticsData = await loadTaskAnalytics();
                
                // Step 4: Calculate analytics data
                updateGlobalLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
                calculateAnalytics(overviewData, taskAnalyticsData);
                
                // Step 5: Update UI components
                updateGlobalLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠...');
                updateSummaryCard();
                updateKPICards();
                updateGoalsAndAchievements(overviewData);
                
                // Step 6: Create charts if canvas elements exist
                updateGlobalLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü...');
                await createCharts();
                
                hideGlobalLoading();
                
                if (tasksData.length === 0) {
                    showNotification('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥', 'info');
                } else {
                    showNotification('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                }
                
            } catch (error) {
                console.error('Analytics loading error:', error);
                hideGlobalLoading();
                handleApiError(error, '‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', true);
                
                // Show fallback message if no data
                showEmptyState();
            }
        }
        
        async function createCharts() {
            try {
                // Create charts only if canvas elements exist
                const productivityCanvas = document.getElementById('productivity-canvas');
                const priorityCanvas = document.getElementById('priority-canvas');
                const weeklyCanvas = document.getElementById('weekly-canvas');
                const timeCanvas = document.getElementById('time-canvas');
                
                if (productivityCanvas) {
                    createProductivityChart();
                }
                
                if (priorityCanvas) {
                    createPriorityChart();
                }
                
                if (weeklyCanvas) {
                    createWeeklyChart();
                }
                
                if (timeCanvas) {
                    createTimeChart();
                }
            } catch (error) {
                console.warn('Chart creation error:', error);
                showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÑ‡∏î‡πâ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥', 'warning');
            }
        }
        
        function showEmptyState() {
            const content = document.querySelector('.container');
            if (content) {
                const analyticsSection = content.querySelector('.bg-white');
                if (analyticsSection) {
                    analyticsSection.innerHTML = createEmptyState({
                        icon: 'üìä',
                        title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå',
                        description: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå',
                        actionText: 'üìù ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô',
                        actionCallback: "window.location.href='tasks.html'"
                    });
                }
            }
        }
        
        // Start the analytics page
        document.addEventListener('DOMContentLoaded', function() {
            initAnalytics();
        });
    </script>

    <!-- Navigation Component -->
    <script src="nav-component.js"></script>

    <!-- Vercel Analytics -->
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
